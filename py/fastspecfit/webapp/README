# one time--
  mamba create -n fastspecfit-webapp python numpy scipy matplotlib astropy Django
  mamba activate fastspecfit-webapp
  pip install fitsio django-filter psycopg2
  tdir=$(mktemp -d)
  pushd $tdir
  for package in desiutil desitarget; do git clone https://github.com/desihub/$package && cd $package && python setup.py install && cd ..; done
  popd

module load python
mamba activate fastspecfit-webapp
export PYTHONPATH=/global/cfs/cdirs/desi/spectro/fastspecfit/webapp/py:$PYTHONPATH
export DJANGO_SETTINGS_MODULE=fastspecfit.webapp.settings
export POSTGRES_DB_PASSWORD=[insert-the-password-here]
cd /global/cfs/cdirs/desi/spectro/fastspecfit/webapp/py/fastspecfit/webapp

# one time--
  python manage.py makemigrations sample

# every time--

# note that if the pre-production database gets funky, you can reset it by doing
find . -path "*/migrations/*.py" -not -name "__init__.py" -delete
find . -path "*/migrations/*.pyc"  -delete
python manage.py makemigrations
python manage.py migrate
python load.py
chgrp -R desi *
touch wsgi.py
